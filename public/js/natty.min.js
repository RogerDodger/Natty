"use strict";Date.prototype.getShortMonth=function(){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][this.getMonth()]},Number.prototype.zeropad=function(e){for(var t=""+this,a=e-t.length,n="";a-- >0;)n+="0";return n+t},$(document).ajaxError(function(e,t){"string"==typeof t.responseText&&t.responseText.length?toastr.error(t.responseText):toastr.error(t.status+" "+t.statusText)}),$(document).ready(function(){var e=$.when();$(".Team-player--swap .fa-exchange").click(function(e){$(".Team-player").removeClass("subbing"),$(this).closest(".Team-player").addClass("subbing")}),$(".Team-player--swap .fa-close").click(function(){$(".Team-player").removeClass("subbing")});var t=$(".Player");t.click(function(t){t.preventDefault();var a=$(this),n=a.find("form"),r=$(".subbing");e=e.then(r.length?$.ajax({method:"POST",url:"/team/sub",data:{team_id:r.closest(".Team").attr("data-id"),oldp_id:r.attr("data-id"),newp_id:a.attr("data-id")},success:function(e){r.removeClass("subbing"),r.attr("data-id",e.id),r.find(".Team-player--name").text(e.tag),r.find(".Team-player--rating").text(e.mu)}}):$.ajax({method:"POST",url:n.attr("action"),success:function(e){"1"===e?a.addClass("online"):a.removeClass("online")}}))}),$(".Player-online--bulk input").click(function(a){a.preventDefault();var n=$(this),r=n.closest("form");e=e.then($.ajax({method:"POST",url:r.attr("action"),success:function(e){"All on"==n.val()?t.addClass("online"):"All off"==n.val()&&t.removeClass("online")}}))})}),$(document).ready(function(){$("time.datetime").each(function(){var e=new Date(this.dateTime);this.textContent=e.getShortMonth()+" "+e.getDate()+" "+ +e.getHours().zeropad(2)+":"+e.getMinutes().zeropad(2)}),$(".Fixture-form--start option").each(function(){var e=new Date(this.value);this.textContent=e.getHours().zeropad(2)+":"+e.getMinutes().zeropad(2)})}),$(document).ready(function(){function e(){this.rows=(this.value||"").split(/\n/).length}var t=$(".Fixture-form");if(t.length){$(".Fixture-form--teams").change(function(){var e=this.value;$("#draw").empty(),$(".Fixture-form--submit").addClass("hidden");var t=$(".Fixture-form--or, .Fixture-form--preset"),a=$('[name="preset"] option').addClass("hidden"),n=a.filter('[data-teams="'+e+'"]').removeClass("hidden");n.length?(n.get(0).selected=!0,t.removeClass("hidden")):t.addClass("hidden"),$(".Team").each(function(t){t<e?$(this).removeClass("hidden"):($(this).addClass("hidden"),$(this).find("textarea").val("").attr("rows",1))})}).change(),$(".Team textarea").on("input",e).trigger("input"),$(".Fixture-form--generate-teams").click(function(t){$.ajax({method:"GET",url:"/team/generate",data:{teams:$(".Fixture-form--teams").val()},success:function(t){$(".Team:not(:hidden) textarea").each(function(a){this.value=t.teams[a].join("\n"),e.call(this)})}})});var a=function(e){return function(t){var a=$(this).addClass("loading");$.ajax({method:"GET",url:e,data:a.closest("form").serialize(),success:function(e){$("#draw").html(e),$(".Fixture-form--submit").removeClass("hidden")},complete:function(){a.removeClass("loading")}})}};$(".Fixture-form--generate-draw").click(a("/fixture/draw-gen")),$(".Fixture-form--get-draw").click(a("/fixture/draw-get"))}}),$(document).ready(function(){var e=$(".Draw-list--filters");if(e.length){var t=e.find('[name="teams"]');e.change("select",function(){$(".Draw.preset").addClass("hidden").filter('[data-teams="'+t.val()+'"]').removeClass("hidden")}).trigger("change"),$(".Draw-expand").click(function(){var e=$(this).closest(".Draw"),t=e.find(".Draw-breakdown"),a=e.find(".spinner"),n=$(this);a.hasClass("hidden")&&("add"==n.text()?(n.text("hourglass_empty"),a.removeClass("hidden"),$.ajax({url:"/draw/parse",method:"GET",data:{draw:e.find(".Draw-code").attr("data-code")},success:function(e){t.html(e)},complete:function(e,t){n.text("error"==t?"add":"remove"),a.addClass("hidden")}})):(n.text("add"),t.empty()))}),$(".Draw-manual--field").on("input",function(){this.value=this.value.replace(/[^\d; ]/,"")}),$(".Draw-reload").click(function(){var e=$(this).closest(".Draw"),t=e.find(".Draw-breakdown"),a=e.find(".spinner");t.empty(),a.removeClass("hidden"),$.ajax({url:"/draw/parse",method:"GET",data:{draw:e.find(".Draw-manual--field").val()},success:function(e){t.html(e)},complete:function(){a.addClass("hidden")}})})}}),$(document).ready(function(){var e=$(".Draw-generator");if(e.length){var t,a,n,r,o,i,s,d=e.find("[name='gen-teams']"),l=e.find("[name='gen-games']"),u=e.find(".Draw-generator--code"),c=e.find(".Draw"),f=c.find(".Draw-breakdown"),m=c.find(".spinner"),h=$(".Draw-generator--setup"),p=$(".Draw-generator--go"),v=function(){return m.removeClass("hidden"),f.empty(),$.ajax({url:"/draw/parse",method:"GET",data:{draw:u.text()},success:function(e){f.html(e)},complete:function(){m.addClass("hidden")}})},g=function(){var e,t,a,n="";if("undefined"!=typeof r){for(t=0;t<r.length;++t){for(e=r[t],a=0;a<e.length;++a)n+=" "+(e[a]+1);t!=r.length-1&&(n+=";")}u.text(n.trim())}};h.click(function(){var s;if(!e.get(0).checkValidity())return toastr.error("Invalid parameters");for(t=d.val(),a=l.val(),n=3*a/t,i=0,o=1/0,r=[],s=0;s<a;++s)r.push([(3*s+0)%t,(3*s+1)%t,(3*s+2)%t]);g(),v()});var x=function(){var e,a,n=new Array(t);for(e=0;e<t;++e)for(n[e]=new Array(t),a=0;a<t;++a)n[e][a]=0;return r.forEach(function(t){for(e=0;e<3;++e)for(a=e+1;a<3;++a)++n[t[e]][t[a]],++n[t[a]][t[e]]}),n},w=function(){return 0},C=function(){var e,a,r=0,o=2*n/(t-1),i=x();for(e=0;e<t;++e)for(a=1;a<t;++a)r+=i[e][a]?40*Math.pow(i[e][a]-o,4):100;return r},y=function(){var e,t,a,n,s,d,l,u=r.map(function(e){return[e[0],e[1],e[2]]});for(e=Math.min(i,96);e<100;++e){do n=Math.floor(3*Math.random()),t=Math.floor(Math.random()*r.length),a=Math.floor(Math.random()*r.length),s=r[t][n],d=r[a][n];while(r[t].indexOf(d)!==-1||r[a].indexOf(s)!==-1);r[t][n]=d,r[a][n]=s}l=C()+w(),l<o?(console.log(l+" < "+o),i=0,o=l,g()):(++i,i>250&&(i=50),r=u)};p.click(function(){return"undefined"==typeof r?void toastr.error("Grid not setup"):void("Go"===p.text()?(p.text("Stop"),h.prop("disabled",!0),f.empty(),m.removeClass("hidden"),s=setInterval(y,0)):"Stop"===p.text()&&(p.text("Stopping"),clearInterval(s),v().then(function(){p.text("Go"),h.prop("disabled",!1)})))})}});
//# sourceMappingURL=/js/natty.min.js.map