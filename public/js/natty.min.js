"use strict";!function(){function e(a,r){if(null==a)return[];if(a.length<2)return a;null==r&&(r=t);var o,i,s;return o=~~(a.length/2),i=e(a.slice(0,o),r),s=e(a.slice(o,a.length),r),n(i,s,r)}function t(e,t){return e<t?-1:e>t?1:0}function n(e,t,n){for(var a=[];e.length&&t.length;)n(e[0],t[0])<=0?a.push(e.shift()):a.push(t.shift());return e.length&&a.push.apply(a,e),t.length&&a.push.apply(a,t),a}Array.prototype.mergesort=function(t){return e(this,t)}}(),Date.prototype.getShortMonth=function(){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][this.getMonth()]},"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),Number.prototype.zeropad=function(e){for(var t=""+this,n=e-t.length,a="";n-- >0;)a+="0";return a+t},String.prototype.zeropad=function(e){for(var t=this,n=e-t.length;n-- >0;)t+="0";return t},$(document).ajaxError(function(e,t){"string"==typeof t.responseText&&t.responseText.length?toastr.error(t.responseText):toastr.error(t.status+" "+t.statusText)}),$(document).ready(function(){var e=$.when();$(".Team-player--swap .fa-exchange").click(function(e){$(".Team-player").removeClass("subbing"),$(this).closest(".Team-player").addClass("subbing")}),$(".Team-player--swap .fa-close").click(function(){$(".Team-player").removeClass("subbing")});var t=$(".Player");t.click(function(t){t.preventDefault();var n=$(this),a=n.find("form"),r=$(".subbing");e=e.then(r.length?$.ajax({method:"POST",url:"/team/sub",data:{team_id:r.closest(".Team").attr("data-id"),oldp_id:r.attr("data-id"),newp_id:n.attr("data-id")},success:function(e){r.removeClass("subbing"),r.attr("data-id",e.id),r.find(".Team-player--name").text(e.tag),r.find(".Team-player--rating").text(e.mu)}}):$.ajax({method:"POST",url:a.attr("action"),success:function(e){"1"===e?n.addClass("online"):n.removeClass("online")}}))}),$(".Player-online--bulk input").click(function(n){n.preventDefault();var a=$(this),r=a.closest("form");e=e.then($.ajax({method:"POST",url:r.attr("action"),success:function(e){"All on"==a.val()?t.addClass("online"):"All off"==a.val()&&t.removeClass("online")}}))})}),$(document).ready(function(){$("time.datetime").each(function(){var e=new Date(this.dateTime);this.textContent=e.getShortMonth()+" "+e.getDate()+" "+ +e.getHours().zeropad(2)+":"+e.getMinutes().zeropad(2)}),$(".Fixture-form--start option").each(function(){var e=new Date(this.value);this.textContent=e.getHours().zeropad(2)+":"+e.getMinutes().zeropad(2)})}),$(document).ready(function(){function e(){this.rows=(this.value||"").split(/\n/).length}var t=$(".Fixture-form");if(t.length){$(".Fixture-form--teams").change(function(){var e=this.value;$("#draw").empty(),$(".Fixture-form--submit").addClass("hidden");var t=$(".Fixture-form--or, .Fixture-form--preset"),n=$('[name="preset"] option').addClass("hidden"),a=n.filter('[data-teams="'+e+'"]').removeClass("hidden");a.length?(a.get(0).selected=!0,t.removeClass("hidden")):t.addClass("hidden"),$(".Team").each(function(t){t<e?$(this).removeClass("hidden"):($(this).addClass("hidden"),$(this).find("textarea").val("").attr("rows",1))})}).change(),$(".Team textarea").on("input",e).trigger("input"),$(".Fixture-form--generate-teams").click(function(t){$.ajax({method:"GET",url:"/team/generate",data:{teams:$(".Fixture-form--teams").val()},success:function(t){$(".Team:not(:hidden) textarea").each(function(n){this.value=t.teams[n].join("\n"),e.call(this)})}})});var n=function(e){return function(t){var n=$(this).addClass("loading");$.ajax({method:"GET",url:e,data:n.closest("form").serialize(),success:function(e){$("#draw").html(e),$(".Fixture-form--submit").removeClass("hidden")},complete:function(){n.removeClass("loading")}})}};$(".Fixture-form--generate-draw").click(n("/fixture/draw-gen")),$(".Fixture-form--get-draw").click(n("/fixture/draw-get"))}}),$(document).ready(function(){var e=$(".Draw-list--filters");if(e.length){var t=e.find('[name="teams"]');e.change("select",function(){$(".Draw.preset").addClass("hidden").filter('[data-teams="'+t.val()+'"]').removeClass("hidden")}).trigger("change"),$(".Draw-expand").click(function(){var e=$(this).closest(".Draw"),t=e.find(".Draw-breakdown"),n=e.find(".spinner"),a=$(this);n.hasClass("hidden")&&("add"==a.text()?(a.text("hourglass_empty"),n.removeClass("hidden"),$.ajax({url:"/draw/parse",method:"GET",data:{draw:e.find(".Draw-code").attr("data-code")},success:function(e){t.html(e)},complete:function(e,t){a.text("error"==t?"add":"remove"),n.addClass("hidden")}})):(a.text("add"),t.empty()))}),$(".Draw-manual--field").on("input",function(){this.value=this.value.replace(/[^\d; ]/,"")}),$(".Draw-reload").click(function(){var e=$(this).closest(".Draw"),t=e.find(".Draw-breakdown"),n=e.find(".spinner");t.empty(),n.removeClass("hidden"),$.ajax({url:"/draw/parse",method:"GET",data:{draw:e.find(".Draw-manual--field").val()},success:function(e){t.html(e)},complete:function(){n.addClass("hidden")}})})}}),$(document).ready(function(){var e=$(".Draw-generator");if(e.length){var t,n,a,r,o,i,s,l=e.find("[name='gen-teams']"),d=e.find("[name='gen-games']"),c=e.find(".Draw-generator--code"),u=e.find(".Draw"),f=u.find(".Draw-breakdown"),m=u.find(".spinner"),h=$(".Draw-generator--setup"),p=$(".Draw-generator--go"),g=function(){return m.removeClass("hidden"),f.empty(),$.ajax({url:"/draw/parse",method:"GET",data:{draw:c.text()},success:function(e){f.html(e)},complete:function(){m.addClass("hidden")}})},v=function(){var e,t,n,a="";if("undefined"!=typeof r){for(t=0;t<r.length;++t){for(e=r[t],n=0;n<e.length;++n)a+=" "+(e[n]+1);t!=r.length-1&&(a+=";")}c.text(a.trim())}};h.click(function(){var s;if(!e.get(0).checkValidity())return toastr.error("Invalid parameters");for(t=l.val(),n=d.val(),a=3*n/t,i=0,o=1/0,r=[],s=0;s<n;++s)r.push([(3*s+0)%t,(3*s+1)%t,(3*s+2)%t]);v(),g()});var y=function(){var e,n,a=new Array(t);for(e=0;e<t;++e)for(a[e]=new Array(t),n=0;n<t;++n)a[e][n]=0;return r.forEach(function(t){for(e=0;e<3;++e)for(n=e+1;n<3;++n)++a[t[e]][t[n]],++a[t[n]][t[e]]}),a},T=function(){return 0},x=function(){var e,n,r=0,o=2*a/(t-1),i=y();for(e=0;e<t;++e)for(n=1;n<t;++n)r+=i[e][n]?40*Math.pow(i[e][n]-o,4):100;return r},w=function(){var e,t,n,a,s,l,d,c=r.map(function(e){return[e[0],e[1],e[2]]});for(e=Math.min(i,96);e<100;++e){do a=Math.floor(3*Math.random()),t=Math.floor(Math.random()*r.length),n=Math.floor(Math.random()*r.length),s=r[t][a],l=r[n][a];while(r[t].indexOf(l)!==-1||r[n].indexOf(s)!==-1);r[t][a]=l,r[n][a]=s}d=x()+T(),d<o?(console.log(d+" < "+o),i=0,o=d,v()):(++i,i>250&&(i=50),r=c)};p.click(function(){return"undefined"==typeof r?void toastr.error("Grid not setup"):void("Go"===p.text()?(p.text("Stop"),h.prop("disabled",!0),f.empty(),m.removeClass("hidden"),s=setInterval(w,0)):"Stop"===p.text()&&(p.text("Stopping"),clearInterval(s),g().then(function(){p.text("Go"),h.prop("disabled",!1)})))})}}),$(document).ready(function(){var e=$(".TB--Input"),t=$(".TB--Add"),n=$(".TB--Balance"),a=$(".TB--Clear"),r=$(".TB--Teams"),o=$(".TB--Cap"),i=!1;if(e.length){var s=$(".TB--Team").get(),l=dragula(s,{direction:"vertical",removeOnSpill:!0,moves:function(e,t,n,a){return e.classList.contains("TB--Team--Player")},accepts:function(e,t,n,a){return null===a||!a.classList.contains("TB--Team--Sum")}}),d=[],c=function(e,t){var n="undefined"==typeof t||t,a=e.players.map(function(e){return e.rating});if(e.sum=0,a.forEach(function(t){e.sum+=t}),i)for(var r=5;r<a.length;++r){for(var o=0,s=1;s<a.length;++s)a[s]<a[o]&&(o=s);e.sum-=a[o],a[o]=+(1/0)}n&&"el"in e&&(e.el.firstChild.innerHTML=e.sum.toFixed(2).zeropad(4))},u=function(){d.forEach(c)},f=function(){var e=r.get(0);e.innerHTML="",s.length=0;for(var t=0;t<d.length;++t){var i=d[t],l=i.players,c=document.createElement("div");c.className="TB--Team",s.push(c);var u=document.createElement("div");u.className="TB--Team--Sum",u.innerHTML=i.sum.toFixed(2).zeropad(4),c.insertAdjacentElement("beforeend",u);for(var f=0;f<l.length;++f){var m=document.createElement("div");m.className="TB--Team--Player";var h=document.createElement("div");h.className="TB--TP--Lock",h.insertAdjacentHTML("afterbegin",'<i class="icon">'+(l[f].locked?"lock":"lock_open")+"</i>");var p=document.createElement("div");p.className="TB--TP--Name",p.innerHTML=l[f].name;var g=document.createElement("div");g.className="TB--TP--Rating",g.innerHTML=l[f].rating.toFixed(2).zeropad(4),[h,p,g].forEach(function(e){m.insertAdjacentElement("beforeend",e)}),c.insertAdjacentElement("beforeend",m),m.pobj=l[f],l[f].el=m}c.tobj=i,i.el=c,e.insertAdjacentElement("beforeend",c)}d.length>=2?n.removeClass("hidden"):n.addClass("hidden"),d.length?a.add(o).removeClass("hidden"):a.add(o).addClass("hidden")},m=function(){if("undefined"!=typeof localStorage){var e=d.map(function(e){return{sum:e.sum,players:e.players.map(function(e){return{name:e.name,rating:e.rating,locked:e.locked}})}});localStorage.setItem("balancerteams",JSON.stringify(e))}},h=function(){"undefined"!=typeof localStorage&&(localStorage.getItem("balancerteams")&&(d=JSON.parse(localStorage.getItem("balancerteams"))),f())};h(),o.find("input").click(function(){i=this.checked,u()}),t.click(function(){var t,n=0;e.val().split("\n").forEach(function(e){if(t=e.match(/^(.+) (\d?.\d+)/)){for(;n<d.length&&d[n].players.length>=5;)n++;n==d.length&&d.push({sum:0,players:[]}),d[n].players.push({rating:parseFloat(t[2]),name:t[1],locked:!1})}}),e.val(""),u(),m(),f()}),r.on("click",".TB--TP--Lock",function(e){var t=$(e.target).closest(".TB--Team--Player"),n=t.get(0).pobj,a=t.find(".TB--TP--Lock .icon").get(0);n.locked=!n.locked,a.innerHTML=n.locked?"lock":"lock_open",m()});var p=function(e,t){for(var n=t.tobj.players,a=0;a<n.length;++a)n[a]===e.pobj&&n.splice(a,1);0==n.length&&(d=d.filter(function(e){return e.el!==t}),t.remove()),c(t.tobj)};l.on("drop",function(e,t,n,a){p(e,n);for(var r=t.getElementsByClassName("TB--Team--Player"),o=0;o<r.length;++o)r[o]===e&&t.tobj.players.splice(o,0,e.pobj);c(t.tobj)}),l.on("remove",function(e,t,n){toastr.warning("Player removed: "+e.pobj.name+" "+e.pobj.rating),p(e,n),m()}),a.on("click",function(){d=[],m(),f()}),n.on("click",function(){var e=function(){var e=0;d.forEach(function(t){e+=t.sum}),e/=d.length;var t=0;return d.forEach(function(n){t+=Math.pow(Math.abs(n.sum-e),2)}),t/d.length},t=[];d.forEach(function(e,n){e.players.forEach(function(e,a){e.locked||t.push({y:n,x:a})})});var n,a,r,o,i=function(e,t){var n=d[e.y].players[e.x],a=d[t.y].players[t.x];d[e.y].players[e.x]=a,d[t.y].players[t.x]=n,c(d[e.y],!1),c(d[t.y],!1)},s=e(),l=[],u=1,h=0,p=function(){for(;l.length;){var e=l.pop();i(e[0],e[1])}};for(o=0;o<5e4;++o)n=t[Math.floor(Math.random()*t.length)],a=t[Math.floor(Math.random()*t.length)],n.y!==a.y&&(i(n,a),r=e(),r<s?(h++,s=r,l=[],u=1):(l.push([n,a]),l.length>=u&&(p(),u=u%20+1)));p(),d.forEach(function(e){e.players=e.players.mergesort(function(e,t){return e.locked||t.locked?0:e.rating>t.rating?-1:e.rating==t.rating?0:1})}),m(),f()})}});
//# sourceMappingURL=/js/natty.min.js.map