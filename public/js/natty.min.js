"use strict";!function(){function e(a,r){if(null==a)return[];if(a.length<2)return a;null==r&&(r=t);var o,i,s;return o=~~(a.length/2),i=e(a.slice(0,o),r),s=e(a.slice(o,a.length),r),n(i,s,r)}function t(e,t){return e<t?-1:e>t?1:0}function n(e,t,n){for(var a=[];e.length&&t.length;)n(e[0],t[0])<=0?a.push(e.shift()):a.push(t.shift());return e.length&&a.push.apply(a,e),t.length&&a.push.apply(a,t),a}Array.prototype.mergesort=function(t){return e(this,t)}}(),Date.prototype.getShortMonth=function(){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][this.getMonth()]},"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),Number.prototype.zeropad=function(e){for(var t=""+this,n=e-t.length,a="";n-- >0;)a+="0";return a+t},String.prototype.zeropad=function(e){for(var t=this,n=e-t.length;n-- >0;)t+="0";return t},$(document).ajaxError(function(e,t){"string"==typeof t.responseText&&t.responseText.length?toastr.error(t.responseText):toastr.error(t.status+" "+t.statusText)}),$(document).ready(function(){var e=$.when();$(".Team-player--swap .fa-exchange").click(function(e){$(".Team-player").removeClass("subbing"),$(this).closest(".Team-player").addClass("subbing")}),$(".Team-player--swap .fa-close").click(function(){$(".Team-player").removeClass("subbing")});var t=$(".Player");t.click(function(t){t.preventDefault();var n=$(this),a=n.find("form"),r=$(".subbing");e=e.then(r.length?$.ajax({method:"POST",url:"/team/sub",data:{team_id:r.closest(".Team").attr("data-id"),oldp_id:r.attr("data-id"),newp_id:n.attr("data-id")},success:function(e){r.removeClass("subbing"),r.attr("data-id",e.id),r.find(".Team-player--name").text(e.tag),r.find(".Team-player--rating").text(e.mu)}}):$.ajax({method:"POST",url:a.attr("action"),success:function(e){"1"===e?n.addClass("online"):n.removeClass("online")}}))}),$(".Player-online--bulk input").click(function(n){n.preventDefault();var a=$(this),r=a.closest("form");e=e.then($.ajax({method:"POST",url:r.attr("action"),success:function(e){"All on"==a.val()?t.addClass("online"):"All off"==a.val()&&t.removeClass("online")}}))})}),$(document).ready(function(){$("time.datetime").each(function(){var e=new Date(this.dateTime);this.textContent=e.getShortMonth()+" "+e.getDate()+" "+ +e.getHours().zeropad(2)+":"+e.getMinutes().zeropad(2)}),$(".Fixture-form--start option").each(function(){var e=new Date(this.value);this.textContent=e.getHours().zeropad(2)+":"+e.getMinutes().zeropad(2)})}),$(document).ready(function(){function e(){this.rows=(this.value||"").split(/\n/).length}var t=$(".Fixture-form");if(t.length){$(".Fixture-form--teams").change(function(){var e=this.value;$("#draw").empty(),$(".Fixture-form--submit").addClass("hidden");var t=$(".Fixture-form--or, .Fixture-form--preset"),n=$('[name="preset"] option').addClass("hidden"),a=n.filter('[data-teams="'+e+'"]').removeClass("hidden");a.length?(a.get(0).selected=!0,t.removeClass("hidden")):t.addClass("hidden"),$(".Team").each(function(t){t<e?$(this).removeClass("hidden"):($(this).addClass("hidden"),$(this).find("textarea").val("").attr("rows",1))})}).change(),$(".Team textarea").on("input",e).trigger("input"),$(".Fixture-form--generate-teams").click(function(t){$.ajax({method:"GET",url:"/team/generate",data:{teams:$(".Fixture-form--teams").val()},success:function(t){$(".Team:not(:hidden) textarea").each(function(n){this.value=t.teams[n].join("\n"),e.call(this)})}})});var n=function(e){return function(t){var n=$(this).addClass("loading");$.ajax({method:"GET",url:e,data:n.closest("form").serialize(),success:function(e){$("#draw").html(e),$(".Fixture-form--submit").removeClass("hidden")},complete:function(){n.removeClass("loading")}})}};$(".Fixture-form--generate-draw").click(n("/fixture/draw-gen")),$(".Fixture-form--get-draw").click(n("/fixture/draw-get"))}}),$(document).ready(function(){var e=$(".Draw-list--filters");if(e.length){var t=e.find('[name="teams"]');e.change("select",function(){$(".Draw.preset").addClass("hidden").filter('[data-teams="'+t.val()+'"]').removeClass("hidden")}).trigger("change"),$(".Draw-expand").click(function(){var e=$(this).closest(".Draw"),t=e.find(".Draw-breakdown"),n=e.find(".spinner"),a=$(this);n.hasClass("hidden")&&("add"==a.text()?(a.text("hourglass_empty"),n.removeClass("hidden"),$.ajax({url:"/draw/parse",method:"GET",data:{draw:e.find(".Draw-code").attr("data-code")},success:function(e){t.html(e)},complete:function(e,t){a.text("error"==t?"add":"remove"),n.addClass("hidden")}})):(a.text("add"),t.empty()))}),$(".Draw-manual--field").on("input",function(){this.value=this.value.replace(/[^\d; ]/,"")}),$(".Draw-reload").click(function(){var e=$(this).closest(".Draw"),t=e.find(".Draw-breakdown"),n=e.find(".spinner");t.empty(),n.removeClass("hidden"),$.ajax({url:"/draw/parse",method:"GET",data:{draw:e.find(".Draw-manual--field").val()},success:function(e){t.html(e)},complete:function(){n.addClass("hidden")}})})}}),$(document).ready(function(){var e=$(".Draw-generator");if(e.length){var t,n,a,r,o,i,s,l=e.find("[name='gen-teams']"),d=e.find("[name='gen-games']"),c=e.find(".Draw-generator--code"),u=e.find(".Draw"),f=u.find(".Draw-breakdown"),m=u.find(".spinner"),h=$(".Draw-generator--setup"),p=$(".Draw-generator--go"),v=function(){return m.removeClass("hidden"),f.empty(),$.ajax({url:"/draw/parse",method:"GET",data:{draw:c.text()},success:function(e){f.html(e)},complete:function(){m.addClass("hidden")}})},g=function(){var e,t,n,a="";if("undefined"!=typeof r){for(t=0;t<r.length;++t){for(e=r[t],n=0;n<e.length;++n)a+=" "+(e[n]+1);t!=r.length-1&&(a+=";")}c.text(a.trim())}};h.click(function(){var s;if(!e.get(0).checkValidity())return toastr.error("Invalid parameters");for(t=l.val(),n=d.val(),a=3*n/t,i=0,o=1/0,r=[],s=0;s<n;++s)r.push([(3*s+0)%t,(3*s+1)%t,(3*s+2)%t]);g(),v()});var y=function(){var e,n,a=new Array(t);for(e=0;e<t;++e)for(a[e]=new Array(t),n=0;n<t;++n)a[e][n]=0;return r.forEach(function(t){for(e=0;e<3;++e)for(n=e+1;n<3;++n)++a[t[e]][t[n]],++a[t[n]][t[e]]}),a},T=function(){return 0},x=function(){var e,n,r=0,o=2*a/(t-1),i=y();for(e=0;e<t;++e)for(n=1;n<t;++n)r+=i[e][n]?40*Math.pow(i[e][n]-o,4):100;return r},w=function(){var e,t,n,a,s,l,d,c=r.map(function(e){return[e[0],e[1],e[2]]});for(e=Math.min(i,96);e<100;++e){do a=Math.floor(3*Math.random()),t=Math.floor(Math.random()*r.length),n=Math.floor(Math.random()*r.length),s=r[t][a],l=r[n][a];while(r[t].indexOf(l)!==-1||r[n].indexOf(s)!==-1);r[t][a]=l,r[n][a]=s}d=x()+T(),d<o?(console.log(d+" < "+o),i=0,o=d,g()):(++i,i>250&&(i=50),r=c)};p.click(function(){return"undefined"==typeof r?void toastr.error("Grid not setup"):void("Go"===p.text()?(p.text("Stop"),h.prop("disabled",!0),f.empty(),m.removeClass("hidden"),s=setInterval(w,0)):"Stop"===p.text()&&(p.text("Stopping"),clearInterval(s),v().then(function(){p.text("Go"),h.prop("disabled",!1)})))})}}),$(document).ready(function(){var e=$(".TB--Input"),t=$(".TB--Add"),n=$(".TB--Balance"),a=$(".TB--Teams");if(e.length){var r=$(".TB--Team").get(),o=dragula(r,{direction:"vertical",removeOnSpill:!0,moves:function(e,t,n,a){return e.classList.contains("TB--Team--Player")},accepts:function(e,t,n,a){return null===a||!a.classList.contains("TB--Team--Sum")}}),i=[],s=function(e,t){var n="undefined"==typeof t||t,a=e.players.map(function(e){return e.rating});e.sum=0,a.forEach(function(t){e.sum+=t});for(var r=5;r<a.length;++r){for(var o=0,i=1;i<a.length;++i)a[i]<a[o]&&(o=i);e.sum-=a[o],a[o]=+(1/0)}n&&"el"in e&&(e.el.firstChild.innerHTML=e.sum.toFixed(2).zeropad(4))},l=function(){i.forEach(s)},d=function(){var e=a.get(0);e.innerHTML="",r.length=0;for(var t=0;t<i.length;++t){var o=i[t],s=o.players,l=document.createElement("div");l.className="TB--Team",r.push(l);var d=document.createElement("div");d.className="TB--Team--Sum",d.innerHTML=o.sum.toFixed(2).zeropad(4),l.insertAdjacentElement("beforeend",d);for(var c=0;c<s.length;++c){var u=document.createElement("div");u.className="TB--Team--Player";var f=document.createElement("div");f.className="TB--TP--Lock",f.insertAdjacentHTML("afterbegin",'<i class="icon">'+(s[c].locked?"lock":"lock_open")+"</i>");var m=document.createElement("div");m.className="TB--TP--Name",m.innerHTML=s[c].name;var h=document.createElement("div");h.className="TB--TP--Rating",h.innerHTML=s[c].rating.toFixed(2).zeropad(4),[f,m,h].forEach(function(e){u.insertAdjacentElement("beforeend",e)}),l.insertAdjacentElement("beforeend",u),u.pobj=s[c],s[c].el=u}l.tobj=o,o.el=l,e.insertAdjacentElement("beforeend",l)}i.length>=2?n.removeClass("hidden"):n.addClass("hidden")};t.click(function(){var t,n=0;e.val().split("\n").forEach(function(e){if(t=e.match(/^(.+) (\d?.\d+)/)){for(;n<i.length&&i[n].players.length>=5;)n++;n==i.length&&i.push({sum:0,players:[]}),i[n].players.push({rating:parseFloat(t[2]),name:t[1],locked:!1})}}),e.val(""),l(),d()}),a.on("click",".TB--TP--Lock",function(e){var t=$(e.target).closest(".TB--Team--Player"),n=t.get(0).pobj,a=t.find(".TB--TP--Lock .icon").get(0);n.locked=!n.locked,a.innerHTML=n.locked?"lock":"lock_open"});var c=function(e,t){for(var n=t.tobj.players,a=0;a<n.length;++a)n[a]===e.pobj&&n.splice(a,1);0==n.length&&(i=i.filter(function(e){return e.el!==t}),t.remove()),s(t.tobj)};o.on("drop",function(e,t,n,a){c(e,n);for(var r=t.getElementsByClassName("TB--Team--Player"),o=0;o<r.length;++o)r[o]===e&&t.tobj.players.splice(o,0,e.pobj);s(t.tobj)}),o.on("remove",function(e,t,n){c(e,n)}),n.on("click",function(){var e=function(){var e=0;i.forEach(function(t){e+=t.sum}),e/=i.length;var t=0;return i.forEach(function(n){t+=Math.pow(Math.abs(n.sum-e),2)}),t/i.length},t=[];i.forEach(function(e,n){e.players.forEach(function(e,a){e.locked||t.push({y:n,x:a})})});var n,a,r,o,l=function(e,t){var n=i[e.y].players[e.x],a=i[t.y].players[t.x];i[e.y].players[e.x]=a,i[t.y].players[t.x]=n,s(i[e.y],!1),s(i[t.y],!1)},c=e(),u=[],f=1,m=0,h=function(){for(;u.length;){var e=u.pop();l(e[0],e[1])}};for(o=0;o<1e4;++o)n=t[Math.floor(Math.random()*t.length)],a=t[Math.floor(Math.random()*t.length)],n.y!==a.y&&(l(n,a),r=e(),r<c?(m++,c=r,u=[],f=1):(u.push([n,a]),u.length>=f&&(h(),f=f%20+1)));h(),i.forEach(function(e){e.players=e.players.mergesort(function(e,t){return e.locked||t.locked?0:e.rating>t.rating?-1:e.rating==t.rating?0:1})}),d()})}});
//# sourceMappingURL=/js/natty.min.js.map